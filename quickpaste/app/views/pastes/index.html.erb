<h1><%= t("pastes.index.title") %></h1>
<p><%= link_to t("pastes.index.new_link"), new_paste_path %></p>

<%= form_with url: pastes_path, method: :get, local: true do |form| %>
  <div class="pastes-search">
    <%= form.label :q, t("pastes.index.search_label"), class: "pastes-search-label" %>
    <div class="pastes-search-row">
      <%= form.search_field :q, value: @query, placeholder: t("pastes.index.search_placeholder"), class: "pastes-search-field" %>
      <%= form.submit t("common.actions.search"), class: "pastes-search-button" %>
    </div>
  </div>
<% end %>

<% @pastes.each do |paste| %>
  <div>
    <%= link_to paste do %>
      <% if paste.locked? %>
        <span class="paste-lock">
          <%= unlocked?(paste) ? "üîì" : "üîí" %>
        </span>
      <% end %>
      <% if paste.read_once %>
        <span class="paste-read-once">‚è±Ô∏è</span>
      <% end %>
      [<%= paste.tag %>] <%= time_ago_in_words(paste.created_at) %> ago
    <% end %>
  </div>
<% end %>

<% if @pagy.pages > 1 %>
  <% window_size = 5 %>
  <% start_page = [@pagy.page - (window_size / 2), 1].max %>
  <% end_page = [start_page + window_size - 1, @pagy.last].min %>
  <% start_page = [end_page - window_size + 1, 1].max %>

  <nav class="pagination">
    <%= link_to t("pastes.index.prev"), url_for(page: @pagy.previous, q: @query.presence), class: "page-link", aria: { disabled: @pagy.previous.nil? } if @pagy.previous %>

    <% (start_page..end_page).each do |page| %>
      <% if page == @pagy.page %>
        <span class="page-link current"><%= page %></span>
      <% else %>
        <%= link_to page, url_for(page: page, q: @query.presence), class: "page-link" %>
      <% end %>
    <% end %>

    <%= link_to t("pastes.index.next"), url_for(page: @pagy.next, q: @query.presence), class: "page-link", aria: { disabled: @pagy.next.nil? } if @pagy.next %>
  </nav>
<% end %>
